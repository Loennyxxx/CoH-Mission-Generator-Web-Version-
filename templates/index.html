<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>NOMOS â€“ Missionsgenerator</title>
<link rel="stylesheet" href="/static/style.css">
<style>
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: Consolas, monospace;
    background-color: #121212;
    color: #e0e0e0;
}

body {
    display: flex;
    flex-direction: column;
}

#container {
    display: flex;
    flex-direction: column;
    flex: 1; /* fÃ¼llt den gesamten Viewport */
    max-width: 1000px;
    margin: 0 auto;
    padding: 10px;
    box-sizing: border-box;
}

#log {
    background-color: #1e1e1e;
    padding: 12px;
    flex: 1; /* fÃ¼llt den verfÃ¼gbaren Raum oberhalb des Buttons */
    overflow-y: auto;
    border-radius: 8px;
    white-space: pre-wrap;
    margin-bottom: 10px; /* Abstand zum Button */
}

#btn {
    background-color: #d32f2f;
    color: white;
    border: none;
    padding: 12px 30px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    align-self: center; /* Button zentriert horizontal */
}

#btn:disabled {
    background-color: #a12a2a;
    cursor: not-allowed;
}
</style>
</head>
<body>

<div id="container">
    <div id="log">
        <pre id="output">Nomos >> System bereit. Warte auf Missionsbefehl.</pre>
    </div>

    <button id="btn">ðŸš€ MISSION GENERIEREN</button>
</div>

<script>
const output = document.getElementById("output");
const btn = document.getElementById("btn");

let polling = false;

// Button startet nur die Mission
btn.onclick = async () => {
    if (btn.disabled) return;

    btn.disabled = true;
    btn.textContent = "â³ GENERIERT...";

    try {
        await fetch("/start", { method: "POST" });
    } catch (err) {
        output.textContent += "\n[Client] Fehler beim Start der Mission.\n";
        btn.disabled = false;
        btn.textContent = "ðŸš€ MISSION GENERIEREN";
    }
};

// Polling lÃ¤uft immer, direkt beim Laden der Seite
async function poll() {
    try {
        const res = await fetch("/logs");
        const data = await res.json();

        output.textContent = data.logs;
        output.scrollTop = output.scrollHeight;

        // Button wieder aktivieren, wenn Mission fertig
        if (!data.running) {
            btn.disabled = false;
            btn.textContent = "ðŸš€ MISSION GENERIEREN";
        }

        setTimeout(poll, 500);
    } catch (err) {
        output.textContent += "\n[Client] Verbindungsfehler.\n";
        setTimeout(poll, 2000); // Retry
    }
}

// Polling direkt beim Laden der Seite starten
window.onload = () => {
    if (!polling) {
        polling = true;
        poll();
    }
};
</script>

</body>
</html>
